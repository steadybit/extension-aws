// SPDX-License-Identifier: MIT
// SPDX-FileCopyrightText: 2023 Steadybit GmbH

package extelb

import (
	"github.com/aws/aws-sdk-go-v2/service/elasticloadbalancingv2/types"
	"github.com/steadybit/extension-aws/v2/config"
)

const (
	albTargetId = "com.steadybit.extension_aws.alb"
	albIcon     = "data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPHN2ZyB2aWV3Qm94PSIwIDAgNDggNDgiIHZlcnNpb249IjEuMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayI+CiAgICA8ZyBpZD0iMSIgc3Ryb2tlPSJub25lIiBzdHJva2Utd2lkdGg9IjEiIGZpbGw9Im5vbmUiIGZpbGwtcnVsZT0iZXZlbm9kZCI+CiAgICAgICAgPHBhdGggZD0iTTMzLjY5LDM0LjM3NSBMMzYuMDM1LDM0LjM3NSBMMzYuMDM1LDMyIEwzMy42OSwzMiBMMzMuNjksMzQuMzc1IFogTTI2Ljc1MSwzNC4zNzUgTDI5LjEyNiwzNC4zNzUgTDI5LjEyNiwzMiBMMjYuNzUxLDMyIEwyNi43NTEsMzQuMzc1IFogTTE4Ljg3NiwzNC4zNzUgTDIxLjI1MSwzNC4zNzUgTDIxLjI1MSwzMiBMMTguODc2LDMyIEwxOC44NzYsMzQuMzc1IFogTTExLjk2NiwzNC4zNzUgTDE0LjI1MSwzNC4zNzUgTDE0LjI1MSwzMiBMMTEuOTY2LDMyIEwxMS45NjYsMzQuMzc1IFogTTE4LjAwMSwxNi44NzUgTDMwLjAwMSwxNi44NzUgTDMwLjAwMSwxMSBMMTguMDAxLDExIEwxOC4wMDEsMTYuODc1IFogTTM3LjAzNSwzMCBMMzUuNTAxLDMwIEwzNS41MDEsMjYuNjI1IEMzNS41MDEsMjYuMDcyIDM1LjA1MywyNS42MjUgMzQuNTAxLDI1LjYyNSBMMzIuMDAxLDI1LjYyNSBMMzIuMDAxLDIyLjI1IEMzMi4wMDEsMjEuNjk3IDMxLjU1MywyMS4yNSAzMS4wMDEsMjEuMjUgTDI1LjAwMSwyMS4yNSBMMjUuMDAxLDE4Ljg3NSBMMzEuMDAxLDE4Ljg3NSBDMzEuNTUzLDE4Ljg3NSAzMi4wMDEsMTguNDI4IDMyLjAwMSwxNy44NzUgTDMyLjAwMSwxMCBDMzIuMDAxLDkuNDQ3IDMxLjU1Myw5IDMxLjAwMSw5IEwxNy4wMDEsOSBDMTYuNDQ4LDkgMTYuMDAxLDkuNDQ3IDE2LjAwMSwxMCBMMTYuMDAxLDE3Ljg3NSBDMTYuMDAxLDE4LjQyOCAxNi40NDgsMTguODc1IDE3LjAwMSwxOC44NzUgTDIzLjAwMSwxOC44NzUgTDIzLjAwMSwyMS4yNSBMMTcuMDAxLDIxLjI1IEMxNi40NDgsMjEuMjUgMTYuMDAxLDIxLjY5NyAxNi4wMDEsMjIuMjUgTDE2LjAwMSwyNS42MjUgTDEzLjUwMSwyNS42MjUgQzEyLjk0OCwyNS42MjUgMTIuNTAxLDI2LjA3MiAxMi41MDEsMjYuNjI1IEwxMi41MDEsMzAgTDEwLjk2NSwzMCBDMTAuNDEzLDMwIDkuOTY1LDMwLjQ0NyA5Ljk2NSwzMSBMOS45NjUsMzUuMzc1IEM5Ljk2NSwzNS45MjggMTAuNDEzLDM2LjM3NSAxMC45NjUsMzYuMzc1IEwxNS4yNTEsMzYuMzc1IEMxNS44MDMsMzYuMzc1IDE2LjI1MSwzNS45MjggMTYuMjUxLDM1LjM3NSBMMTYuMjUxLDMxIEMxNi4yNTEsMzAuNDQ3IDE1LjgwMywzMCAxNS4yNTEsMzAgTDE0LjUwMSwzMCBMMTQuNTAxLDI3LjYyNSBMMTguNjI2LDI3LjYyNSBMMTguNjI2LDMwIEwxNy44NzYsMzAgQzE3LjMyMywzMCAxNi44NzYsMzAuNDQ3IDE2Ljg3NiwzMSBMMTYuODc2LDM1LjM3NSBDMTYuODc2LDM1LjkyOCAxNy4zMjMsMzYuMzc1IDE3Ljg3NiwzNi4zNzUgTDIyLjI1MSwzNi4zNzUgQzIyLjgwMywzNi4zNzUgMjMuMjUxLDM1LjkyOCAyMy4yNTEsMzUuMzc1IEwyMy4yNTEsMzEgQzIzLjI1MSwzMC40NDcgMjIuODAzLDMwIDIyLjI1MSwzMCBMMjAuNjI2LDMwIEwyMC42MjYsMjYuNjI1IEMyMC42MjYsMjYuMDcyIDIwLjE3OCwyNS42MjUgMTkuNjI2LDI1LjYyNSBMMTguMDAxLDI1LjYyNSBMMTguMDAxLDIzLjI1IEwzMC4wMDEsMjMuMjUgTDMwLjAwMSwyNS42MjUgTDI4LjM3NiwyNS42MjUgQzI3LjgyMywyNS42MjUgMjcuMzc2LDI2LjA3MiAyNy4zNzYsMjYuNjI1IEwyNy4zNzYsMzAgTDI1Ljc1MSwzMCBDMjUuMTk4LDMwIDI0Ljc1MSwzMC40NDcgMjQuNzUxLDMxIEwyNC43NTEsMzUuMzc1IEMyNC43NTEsMzUuOTI4IDI1LjE5OCwzNi4zNzUgMjUuNzUxLDM2LjM3NSBMMzAuMTI2LDM2LjM3NSBDMzAuNjc4LDM2LjM3NSAzMS4xMjYsMzUuOTI4IDMxLjEyNiwzNS4zNzUgTDMxLjEyNiwzMSBDMzEuMTI2LDMwLjQ0NyAzMC42NzgsMzAgMzAuMTI2LDMwIEwyOS4zNzYsMzAgTDI5LjM3NiwyNy42MjUgTDMzLjUwMSwyNy42MjUgTDMzLjUwMSwzMCBMMzIuNjksMzAgQzMyLjEzNywzMCAzMS42OSwzMC40NDcgMzEuNjksMzEgTDMxLjY5LDM1LjM3NSBDMzEuNjksMzUuOTI4IDMyLjEzNywzNi4zNzUgMzIuNjksMzYuMzc1IEwzNy4wMzUsMzYuMzc1IEMzNy41ODcsMzYuMzc1IDM4LjAzNSwzNS45MjggMzguMDM1LDM1LjM3NSBMMzguMDM1LDMxIEMzOC4wMzUsMzAuNDQ3IDM3LjU4NywzMCAzNy4wMzUsMzAgTDM3LjAzNSwzMCBaIE0yNC4wMDEsNDQgQzEyLjk3Miw0NCA0LDM1LjAyOCA0LDI0IEM0LDEyLjk3MiAxMi45NzIsNCAyNC4wMDEsNCBDMzUuMDI5LDQgNDQuMDAxLDEyLjk3MiA0NC4wMDEsMjQgQzQ0LjAwMSwzNS4wMjggMzUuMDI5LDQ0IDI0LjAwMSw0NCBMMjQuMDAxLDQ0IFogTTI0LjAwMSwyIEMxMS44NjksMiAyLDExLjg2OSAyLDI0IEMyLDM2LjEzMSAxMS44NjksNDYgMjQuMDAxLDQ2IEMzNi4xMzEsNDYgNDYuMDAxLDM2LjEzMSA0Ni4wMDEsMjQgQzQ2LjAwMSwxMS44NjkgMzYuMTMxLDIgMjQuMDAxLDIgTDI0LjAwMSwyIFoiIGlkPSIyIiBmaWxsPSJjdXJyZW50Q29sb3IiPjwvcGF0aD4KICAgIDwvZz4KPC9zdmc+"
)

func matchesTagFilter(tags []types.Tag, filters []config.TagFilter) bool {
	if len(filters) == 0 {
		return true
	}

	for _, filter := range filters {
		matched := false

		for _, tag := range tags {
			if tag.Key != nil && *tag.Key == filter.Key {
				// Check if at least one value matches
				for _, filterValue := range filter.Values {
					if tag.Value != nil && *tag.Value == filterValue {
						matched = true
						break
					}
				}
			}
			if matched {
				break
			}
		}

		// If a filter didn't match any tags, return false
		if !matched {
			return false
		}
	}

	return true
}
